<!-- layouts/partials/head.html -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        {{ if .IsHome }}
            {{ .Site.Title }}
        {{ else }}
            {{ .Title }} | {{ .Site.Title }}
        {{ end }}
    </title>
    
    <!-- **NEW**: Link Preview (Open Graph & Twitter Card) Logic -->
    {{ if .IsPage }}
        {{ $featured_image := .Resources.GetMatch "{*.jpg,*.jpeg,*.png,*.gif}" }}
        {{ if $featured_image }}
            {{/* Create a 1200x630px preview image, the standard for social sharing */}}
            {{ $preview_image := ($featured_image.Fill "1200x630").Permalink }}
            
            {{/* Build a dynamic description */}}
            {{ $description := .Summary | plainify | truncate 155 }}
            {{ with $featured_image.Exif }}
                {{ with index .Tags "Model" }}{{ $description = printf "%s Shot on %s." $description . }}{{ end }}
            {{ end }}
            {{ $albums := .GetTerms "albums" }}
            {{ if $albums }}{{ $description = printf "%s Albums: %s." $description (delimit (apply $albums "path.Base" ".") ", ") }}{{ end }}

            <!-- Open Graph Meta Tags -->
            <meta property="og:title" content="{{ .Title }}" />
            <meta property="og:description" content="{{ $description }}" />
            <meta property="og:type" content="article" />
            <meta property="og:url" content="{{ .Permalink }}" />
            <meta property="og:image" content="{{ $preview_image }}" />
            <meta property="og:image:width" content="1200" />
            <meta property="og:image:height" content="630" />

            <!-- Twitter Card Meta Tags -->
            <meta name="twitter:card" content="summary_large_image" />
            <meta name="twitter:title" content="{{ .Title }}" />
            <meta name="twitter:description" content="{{ $description }}" />
            <meta name="twitter:image" content="{{ $preview_image }}" />
        {{ end }}
    {{ else }}
        <!-- Fallback description for list pages -->
        <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}">
    {{ end }}
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Fonts & Styles -->
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>

    <!-- Load Justified Gallery CSS on homepage AND term pages -->
    {{ if or .IsHome (eq .Kind "term") }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css" />
    {{ end }}
</head>
