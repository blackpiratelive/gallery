<!-- layouts/_default/single.html -->
{{ $featured_image := .Resources.GetMatch "{*.jpg,*.jpeg,*.png,*.gif}" }}
{{ $name := "" }}
{{ if $featured_image }}
    {{ $name = $featured_image.Name }}
    {{ $name = replace $name "-" " " }}
    {{ $name = replace $name "_" " " }}
    {{ $name = path.BaseName $name }}
    {{ $name = strings.TrimSuffix (path.Ext $name) $name }}
    {{ $name = title $name }}
{{ else }}
    {{ $name = .Title }}
{{ end }}

<!DOCTYPE html>
<html lang="en">
{{- partial "head.html" . -}}
<body class="bg-gray-100 text-gray-800">
    {{- partial "header.html" . -}}
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <article>
            {{ if $featured_image }}
                <div class="mb-8">
                     <img src="{{ $featured_image.RelPermalink }}" alt="{{ $name }}" class="rounded-lg shadow-xl w-full h-auto">
                </div>
            {{ end }}

            <div class="md:flex justify-between items-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold">{{ $name }}</h1>
                {{ if $featured_image }}
                <a href="{{ $featured_image.RelPermalink }}" download
                   class="mt-4 md:mt-0 inline-block bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors text-lg">
                    Download Image
                </a>
                {{ end }}
            </div>
            
            <div class="prose max-w-none mb-12">
                {{ .Content }}
            </div>

            {{ if $featured_image }}
                {{ with $featured_image.Exif }}
                <div class="camera-info border-t pt-8">
                    <h2 class="text-sm font-bold uppercase tracking-wider text-gray-500 mb-4">Details</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        {{ with .Date }}
                        <div class="bg-white p-4 rounded-lg flex items-center shadow">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                            <div><strong class="block text-gray-600">Date</strong> {{ .Format "January 02, 2006" }}</div>
                        </div>
                        {{ end }}
                        {{ with index .Tags "Model" }}
                        <div class="bg-white p-4 rounded-lg flex items-center shadow">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                            <div><strong class="block text-gray-600">Camera Model</strong> {{ . }}</div>
                        </div>
                        {{ end }}
                    </div>
                </div>
                {{ end }}
            {{ end }}

            <div class="mt-8 pt-8 border-t">
                <h3 class="text-sm font-bold uppercase tracking-wider text-gray-500 mb-2">Part of Albums</h3>
                {{ range (.GetTerms "albums") }}
                    <a href="{{ .Permalink }}" class="inline-block bg-blue-100 text-blue-800 text-sm font-medium mr-2 mb-2 px-2.5 py-0.5 rounded-full hover:bg-blue-200">{{ .LinkTitle }}</a>
                {{ end }}
            </div>
        </article>

        <footer class="text-center mt-16 text-gray-500">
            <p>&copy; {{ now.Format "2006" }} {{ .Site.Title }}.</p>
        </footer>
    </div>
</body>
</html>
